import logging
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import ContextTypes, MessageHandler, filters
from config import Config
from db import db

logger = logging.getLogger(__name__)

# ุงูุฅุนุฏุงุฏุงุช ุงูููููุฉ
MAIN_BUTTON = "๐ ุงูุตูุฏูู ุงูุฃุณูุฏ ๐ฅ"
# ุงูุฑุงุจุท ุงูุฃูู: ุฑุงุจุท ุงูุงุดุชุฑุงู ุงูุฎุงุต ุจู
SUBSCRIPTION_LINK = "https://t.me/+ImRWZVEmGbIzYWVk" 
# ุงูุฑุงุจุท ุงูุซุงูู: ุฑุงุจุท ููุงุฉ ุงูุชูุงุตู ูุน ุงููุดุฑู
ADMIN_CHANNEL_LINK = "https://t.me/+nX72izXBXVEzMDNk"

async def setup(application):
    # ุงุณุชุฌุงุจุฉ ุณุฑูุนุฉ ูููุฑูุฉ ูุฒุฑ ุงูุตูุฏูู ุงูุฃุณูุฏ
    application.add_handler(MessageHandler(filters.Regex(f"^{MAIN_BUTTON}$"), show_secret_content), group=-1)

async def show_secret_content(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    user_data = db.get_user(user_id)
    is_vip = user_data.get("is_vip", False)

    if is_vip:
        # ูุงุฌูุฉ ุงููุดุชุฑููู (ุงููุฎุจุฉ)
        text = (
            "โจ **ุฃููุงู ุจู ูู ุนุงูู ุงูุตููุฉ ุงููููู** โจ\n"
            "โโโโโโโโโโโโโโ\n"
            "ุฃูุช ุงูุขู ูู ุงููุฎุชุงุฑูู ุงูุฐูู ูููููู ููุชุงุญ ุงูุณุฑ.. ุงุณุชูุชุน ุจุงููุฒุงูุง ุงูุญุตุฑูุฉ ูุงูุฎุตูุตูุฉ ุงูุชุงูุฉ ูู ุฌููุน ุบุฑู ุงูุจูุช.\n\n"
            "๐ **ูุถุนู ุงูุญุงูู:** ุนุถู ูููู ูุดุท.\n"
            "๐ ุงูุทูู ุงูุขู ูุงูุชุดู ูุง ูุฎุจุฆู ูู ุงูุจูุช."
        )
        kb = [[InlineKeyboardButton("๐ ุฏุฎูู ุงููุงุฏู ุงูุณุฑู", url=SUBSCRIPTION_LINK)]]
    else:
        # ูุงุฌูุฉ ุงูุฅุบุฑุงุก ูุงูุชุดููู (ูุบูุฑ ุงููุดุชุฑููู)
        text = (
            "๐คซ **ใ ูููุณุงุช ุงูุตููุฏูู ุงูุฃุณููุฏ ใ** ๐\n"
            "โโโโโโโโโโโโโโ\n"
            "ูู ูุฏูู ุงููุถูู ููุนุฑูุฉ ูุง ูุญุฏุซ ุฎูู ุงูุณุชุงุฑุ ๐ฅ\n\n"
            "ููุง ุญูุซ ุชูุชูู ุงูุฌุฑุฃุฉ ุจุงูุฃูุงูุฉ.. ููุงูู ุฎูุตุต ููู ูุจุญุซูู ุนู ุชุฌุฑุจุฉ ูุฎุชููุฉ ุชูุงูุงูุ ุจุนูุฏุงู ุนู ุฃุนูู ุงููุชุทูููู.\n\n"
            "โจ **ูุงุฐุง ูุฎุจุฆ ูู ุงุดุชุฑุงู ุงููุฎุจุฉุ**\n"
            "โข ๐ฌ **ูุดุงูุฏ ุญุตุฑูุฉ:** ูุญุธุงุช ุฎุงุตุฉ ูุฎูู ููุงููุณ ุงูุฌูุงู.\n"
            "โข ๐ธ **ุนุงูู ุงูุฅูุงุซ:** ูุตูู ูุจุงุดุฑ ูุบุฑู ุงูุฏุฑุฏุดุฉ ุงููุบููุฉ.\n"
            "โข ๐ **ูููุฉ ููููุฉ:** ุชููุฒ ุนู ุงูุฌููุน ุจุจุฑุณุชูุฌ ุฎุงุต.\n\n"
            "โ๏ธ **ุชูุจูู:** ุงูุตูุฏูู ูุง ููุชุญ ุฅูุง ููู ูุฌุฑุค ุนูู ุงูุชููุฒ."
        )
        
        kb = [
            [InlineKeyboardButton("๐ ุชูุนูู ุงูุนุถููุฉ ุงูููููุฉ (ุงุดุชุฑุงู)", url=SUBSCRIPTION_LINK)],
            [InlineKeyboardButton("๐ฌ ูุฑุงุณูุฉ ุงููุดุฑู (ุงูููุงุฉ ุงูุฑุณููุฉ)", url=ADMIN_CHANNEL_LINK)]
        ]

    await update.message.reply_text(
        text, 
        reply_markup=InlineKeyboardMarkup(kb), 
        parse_mode="Markdown"
    )
